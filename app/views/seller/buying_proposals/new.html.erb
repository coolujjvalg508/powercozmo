<div class="content-wrapper">
  <!-- Content Header (Page header) -->
  <section class="content-header">
    <h1>Submit proposal  </h1>
    <ol class="breadcrumb">
      <li><a href="<%= seller_dashboard_path %>">Home</a></li>
      <li class="active">Submit proposal </li>
    </ol>
  </section>

  <!-- Main content -->
  <section class="content new-msg-content">
    <%= form_for @buying_proposal, url: seller_buying_proposals_path do |f|%>
      <!-- /.row -->
      <div class="row">
        <div class="col-lg-12 col-md-12 my-proposal-cnt">
         	<div class="new-msg-form-box">
           	<div class="myproposal-row">
              <div class="proposal-cnt-area">
                <div class="form-group">
                  <label for="mailto">Buying request name* :</label>
                  <%= f.hidden_field :status, value: 'New'%>
                  <%= f.hidden_field :user_id, value: current_user.id%>
                  <%= f.hidden_field :buying_request_id, value: @buying_request.id%>
                  <input type="text" class="form-control" value="<%= @buying_request.title%>" disabled>
                </div>
              </div>
              <div class="proposal-cnt-area proposal-cnt-area-midd">
                <div class="form-group">
                  <label for="mailto">Buying request serial number* :</label>
                  <input type="text" class="form-control" value="<%= @buying_request.identifier%>" disabled>
                </div>
              </div>
              <div class="proposal-cnt-area">
                <div class="form-group">
                  <label for="mailto">Price* :</label>
                  <%= f.text_field :price, placeholder: 'Enter Price', class: 'form-control'%>
                  <%= error_message(@buying_proposal, :price)%>
                </div>
              </div>
              <div class="clearfix"></div>
            </div>

            <div class="myproposal-row">
              <div class="proposal-cnt-area">
                <div class="form-group">
                  <label for="select">Currency* :</label>
                  <% currency_id = f.object.currency_id %>
                  <%= f.select :currency_id, options_for_select(Currency.select(:symbol, :id, :name).map{|x| [raw(x.symbol)+" (#{x.name})", x.id]}, currency_id), prompt: 'Select Currency*'%>
                  <%= error_message(@buying_proposal, :currency_id)%>
                </div>
              </div>
              <div class="proposal-cnt-area proposal-cnt-area-midd">
                <div class="form-group">
                  <label for="select">Delivery time* :</label>
                  <%= f.select :delivery_time, options_for_select([['Select Delivery time*','']]+(1..3).collect { |week| [week.to_s+" Week".pluralize(week)]  }+(1..24).collect { |month| [month.to_s+" Month".pluralize(month)]  }, selected: f.object.delivery_time) %>
                  <%= error_message(@buying_proposal, :delivery_time)%>
                </div>
              </div>
              <div class="clearfix"></div>
            </div>
            <div class="form-group">
              <label for="mailto">Proposal*  :</label>
              <%= f.text_area :proposal, placeholder: 'Proposal', class: 'form-control', style: 'min-height:300px;'%>
              <%= error_message(@buying_proposal, :proposal)%>
            </div>

             <div class="form-group my-proposal-cnt">
              <!-- <div class="add-propose-img">
                <img src="/assets/photo-browse-img.jpg" alt="" id="buy_image" height="100" width="100">
                <span class="img-field">
                  <%#= f.fields_for :image do |img| %>
                    <%#= img.file_field :image, id: 'filePhoto', accept: 'image/png,image/gif,image/jpeg,image/jpg', style: 'opacity: 0'%>
                  <%#end %>
                </span>
              </div>
              <a href="javascript:void(0)" class="btn btn-default custom-btn upload-photo">UPLOAD</a> -->
              <a href="javascript:void(0)">
              <button type="button" class="btn btn-default attch-btn" id="attach-btn"><i class="fa fa-paperclip"></i> Attachment</button>
                <%= f.file_field :attachment , style: "display:none;", id: "hidden-attach"%>
                <%= f.hidden_field :attachment_cache %>
              </a>
              <span id="propsal-file"><%=@buying_request.attachment? ? @buying_request.attachment.filename : "" %></span>
              <br />
              <span class="max-limit">Max.32MB</span> </div>
            </div>

          </div>
          <div class="form-group">
            <button class="btn btn-default btn-submit custom-btn" type="submit">Submit</button>
          </div>
        </div>
      </div>
    <% end %>
    <!-- /.row -->
  </section>
  <!-- /.content -->
</div>
<!-- /.content-wrapper -->

<style type="text/css">
  .error-msg{
    color: #cc0000;
    font-size: 12px;
  }

  #filePhoto{
    opacity: 0;
    width: 100px;
    height: 100px;
    margin-top: -100px;
  }
  .add-propose-img{
    width: 100px;
    float: left;
    height: 100px;
  }
</style>
<script type="text/javascript">
  $(document).ready(function(){
    $('.upload-photo').click(function(){
      $('#filePhoto').trigger('click');
    })
    $("input[name='buying_proposal[attachment]']").change(function(e){
      var fileName = e.target.files[0].name;
      $("#propsal-file").text(fileName);
    });
    if($("#buying_proposal_attachment_cache").val()){
      arr = $("#buying_proposal_attachment_cache").val().split('/');
      fileName = arr[arr.length - 1];
      $("#propsal-file").text(fileName);
    }

    // $('#buying_proposal_delivery_time').datetimepicker({
    //   format: 'DD-MM-YYYY hh:mm a',
    //   useCurrent: false,
    //   minDate: moment().valueOf()
    // });
    $( "#attach-btn" ).on( "click", function() {
      $('#hidden-attach').click();
    });
  })

  function readURL(input) {
    if (input.files && input.files[0]) {
      var reader = new FileReader();
      reader.onload = function (e) {
        $('#buy_image').attr('src', e.target.result);
      }
      reader.readAsDataURL(input.files[0]);
    }
  }
</script>
