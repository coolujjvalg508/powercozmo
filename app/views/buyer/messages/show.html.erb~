<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper"> 
  <!-- Content Header (Page header) -->
  <section class="content-header">
    <h1>Message Detail </h1>
    <ol class="breadcrumb">
      <li><a href="<%= buyer_dashboard_path %>">Home</a></li>        
      <li class="active">Message Detail</li>
    </ol>
  </section>
  
  <!-- Main content -->
  <section class="content new-msg-content">    
    <!-- /.row -->
    <% @conversation.messages.each_with_index do |message,index| %>
      <% @message = message %>
      <div class="row">
        <div class="col-lg-12 msg-info-area">
          <%= "<h3>Reply Message</h3>".html_safe if index > 0 %>          
          <div class="new-msg-form-box">
            <div class="detail-list-row">
              <div class="detail-list-l">From</div>
              <div class="detail-list-r">
                <%= @message.receipts.try(:sentbox).try(:first).try(:receiver).try(:name) %>
              </div>
              <div class="clearfix"></div>
            </div>
            <div class="detail-list-row">
              <div class="detail-list-l">To</div>
              <div class="detail-list-r">
                <%= @message.receipts.try(:inbox).try(:first).try(:receiver).try(:name) %>                
              </div>
              <div class="clearfix"></div>
            </div>
            <div class="detail-list-row">
              <div class="detail-list-l">Subject</div>
                <div class="detail-list-r"><%= @message.subject %></div>
                <div class="clearfix"></div>
            </div>
            <div class="detail-list-row">
              <div class="detail-list-l">Message</div>
                <div class="detail-list-r"><%= @message.body.to_s.html_safe  %></div>
                <div class="clearfix"></div>
            </div>
            <div class="detail-list-row">
              <div class="detail-list-l">Date &amp; time</div>
                <div class="detail-list-r"><%= message_time_format(@message.created_at) %></div>
                <div class="clearfix"></div>
            </div>
            <% if @message.attachment? %>
              <div class="detail-list-row">
                <div class="detail-list-l">Attachment</div>
                <div class="detail-list-r">
                  <%= link_to "<i class='fa fa-paperclip'></i> #{@message.attachment.try(:url).to_s.split('/').last}".html_safe, @message.attachment.url,target: '_blank'  %>
                </div>
                <div class="clearfix"></div>
              </div>
            <% end %>   
           </div>
        </div>
      </div>
    <% end %>
    <% if @receipt.present? %>
      <div class="row">
        <div class="col-lg-12 msg-info-area">
          <div class="new-msg-form-box">
            <%= form_for :message, url: reply_buyer_message_path(@conversation) , :html => {id: "reply_buyer_message_form", multipart: true} do |f| %>
              <% params[:message] ||= {} %>
              <%= f.hidden_field :subject, value: @message.subject %>
              <%= hidden_field_tag :message_id, @message.id %>
              <div class="form-group reply-msg-err">
                <label for="message">Reply Message * : <span></span></label>
                <%= f.bootsy_area :body, class: 'form-control', id: "message" , placeholder: 'Enter Message', value: params[:message][:body], editor_options: { image: false } %>
                <%= form_error_msg_for(@receipt,'notification.body', 'Message') if @receipt.present? %>              
              </div> <br>
              <div class="form-group">
                <div class="file-upload message_file">            
                  <%= f.file_field :attachment %>
                  <button type="submit" class="btn btn-default attch-btn"><i class="fa fa-paperclip"></i> Attachment</button>
                  <span class="max-limit">Max.32MB</span>
                  <% if defined? @attachment_size %>          
                    <%= "<div class='error-msg'>The attached file size is #{@attachment_size.to_f}MB but it should not exceed 32MB</div>".html_safe if @attachment_size.to_f > 32 %>
                  <% end %>
                </div>
              </div>  
              <div class="form-group">
                <%= f.button :submit, class: "btn btn-default custom-btn sent-mail-btn" do %>
                  Reply
                <% end %>
                <button type="button" onclick="window.location = '<%= inbox_buyer_messages_path %>'" class="btn btn-default custom-btn">Back</button>
                <%= f.submit 'Submit', :class => 'submit_message_form hide' %>
              </div>                         
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
    <!-- /.row -->
  </section>
  <!-- /.content --> 
</div>
  <!-- /.content-wrapper -->
<%= javascript_include_tag "buyer/messages" %>
